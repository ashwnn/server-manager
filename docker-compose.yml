version: '3.8'

services:
  discord-server-bot:
    build:
      context: ./bot
    container_name: discord-server-bot
    env_file:
      - .env
    restart: unless-stopped
    networks:
      - bot-network
    volumes:
      - ./bot:/app
      - ./servers.json:/app/servers.json:ro
      # Mount SSH private key for remote server access
      # Create SSH key with: ssh-keygen -t rsa -b 4096 -f ~/.ssh/server_manager_key
      # Then add the public key to authorized_keys on each managed server
      - ~/.ssh/server_manager_key:/app/.ssh/id_rsa:ro
    # Note: No longer mounting /var/run/docker.sock as we use SSH for remote Docker access
    
    # Optional: constrain resources
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 512M

networks:
  bot-network:
    driver: bridge